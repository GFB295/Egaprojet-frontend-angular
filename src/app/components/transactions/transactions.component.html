<div class="transactions-container">
  <div class="header">
    <h1>Transactions</h1>
    <div class="action-buttons">
      <button class="btn btn-success" (click)="openDepotForm()">Dépôt</button>
      <button class="btn btn-danger" (click)="openRetraitForm()">Retrait</button>
      <button class="btn btn-info" (click)="openVirementForm()">Virement</button>
      <button class="btn btn-primary" (click)="openReleveForm()">Relevé</button>
    </div>
  </div>

  <!-- Success Animation -->
  <div class="success-animation-overlay" *ngIf="showSuccessAnimation" [class.show]="showSuccessAnimation">
    <div class="success-animation" [class.show]="showSuccessAnimation">
      <div class="success-content" [class.depot]="transactionType === 'depot'" 
           [class.retrait]="transactionType === 'retrait'"
           [class.virement]="transactionType === 'virement'">
        <div class="success-icon">
          <div class="icon-wrapper">
            <svg *ngIf="transactionType === 'depot'" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke-width="2"/>
            </svg>
            <svg *ngIf="transactionType === 'retrait'" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M12 22V2M7 19H14.5a3.5 3.5 0 0 0 0-7h-5a3.5 3.5 0 0 1 0-7H18" stroke-width="2"/>
            </svg>
            <svg *ngIf="transactionType === 'virement'" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2"/>
            </svg>
          </div>
          <div class="checkmark" [class.show]="showSuccessAnimation">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M20 6L9 17l-5-5" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
        <p class="success-text">{{ successMessage }}</p>
      </div>
    </div>
  </div>

  <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

  <!-- Depot Modal -->
  <div class="modal" *ngIf="showDepotForm">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Dépôt</h2>
        <button class="close-btn" (click)="closeForms()">&times;</button>
      </div>
      <form [formGroup]="depotForm" (ngSubmit)="submitDepot()">
        <div class="form-group">
          <label>Compte *</label>
          <select formControlName="numeroCompte" class="form-control">
            <option value="">Sélectionner un compte</option>
            <option *ngFor="let compte of comptes" [value]="compte.numeroCompte">
              {{ compte.numeroCompte }} - {{ compte.typeCompte }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Montant *</label>
          <input type="number" formControlName="montant" step="0.01" class="form-control" />
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" formControlName="description" class="form-control" />
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForms()">Annuler</button>
          <button type="submit" class="btn btn-success" [disabled]="depotForm.invalid">Valider</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Retrait Modal -->
  <div class="modal" *ngIf="showRetraitForm">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Retrait</h2>
        <button class="close-btn" (click)="closeForms()">&times;</button>
      </div>
      <form [formGroup]="retraitForm" (ngSubmit)="submitRetrait()">
        <div class="form-group">
          <label>Compte *</label>
          <select formControlName="numeroCompte" class="form-control">
            <option value="">Sélectionner un compte</option>
            <option *ngFor="let compte of comptes" [value]="compte.numeroCompte">
              {{ compte.numeroCompte }} - {{ compte.typeCompte }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Montant *</label>
          <input type="number" formControlName="montant" step="0.01" class="form-control" />
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" formControlName="description" class="form-control" />
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForms()">Annuler</button>
          <button type="submit" class="btn btn-danger" [disabled]="retraitForm.invalid">Valider</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Virement Modal -->
  <div class="modal" *ngIf="showVirementForm">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Virement</h2>
        <button class="close-btn" (click)="closeForms()">&times;</button>
      </div>
      <form [formGroup]="virementForm" (ngSubmit)="submitVirement()">
        <div class="form-group">
          <label>Compte source *</label>
          <select formControlName="compteSource" class="form-control">
            <option value="">Sélectionner un compte</option>
            <option *ngFor="let compte of comptes" [value]="compte.numeroCompte">
              {{ compte.numeroCompte }} - {{ compte.typeCompte }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Compte destinataire *</label>
          <select formControlName="compteDestinataire" class="form-control">
            <option value="">Sélectionner un compte</option>
            <option *ngFor="let compte of comptes" [value]="compte.numeroCompte">
              {{ compte.numeroCompte }} - {{ compte.typeCompte }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Montant *</label>
          <input type="number" formControlName="montant" step="0.01" class="form-control" />
        </div>
        <div class="form-group">
          <label>Description</label>
          <input type="text" formControlName="description" class="form-control" />
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForms()">Annuler</button>
          <button type="submit" class="btn btn-info" [disabled]="virementForm.invalid">Valider</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Releve Modal -->
  <div class="modal" *ngIf="showReleveForm">
    <div class="modal-content large">
      <div class="modal-header">
        <h2>Relevé de compte</h2>
        <button class="close-btn" (click)="closeForms()">&times;</button>
      </div>
      <form [formGroup]="releveForm" (ngSubmit)="submitReleve()">
        <div class="form-row">
          <div class="form-group">
            <label>Compte *</label>
            <select formControlName="numeroCompte" class="form-control">
              <option value="">Sélectionner un compte</option>
              <option *ngFor="let compte of comptes" [value]="compte.numeroCompte">
                {{ compte.numeroCompte }} - {{ compte.typeCompte }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>Date début *</label>
            <input type="date" formControlName="dateDebut" class="form-control" />
          </div>
          <div class="form-group">
            <label>Date fin *</label>
            <input type="date" formControlName="dateFin" class="form-control" />
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForms()">Fermer</button>
          <button type="submit" class="btn btn-primary" [disabled]="releveForm.invalid">Afficher</button>
          <button type="button" class="btn btn-success" (click)="imprimerReleve()" [disabled]="releveForm.invalid || releveTransactions.length === 0">
            Télécharger PDF
          </button>
        </div>
      </form>

      <div *ngIf="releveTransactions.length > 0" class="releve-table">
        <h3>Transactions</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Montant</th>
              <th>Solde après</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let transaction of releveTransactions">
              <td>{{ transaction.dateTransaction | date:'dd/MM/yyyy HH:mm' }}</td>
              <td><span [class]="getTransactionTypeClass(transaction.typeTransaction)">{{ transaction.typeTransaction }}</span></td>
              <td>{{ formatCurrency(transaction.montant) }}</td>
              <td>{{ formatCurrency(transaction.soldeApres) }}</td>
              <td>{{ transaction.description }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
