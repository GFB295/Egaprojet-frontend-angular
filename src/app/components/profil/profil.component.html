<div class="profil-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Chargement de votre profil...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && errorMessage" class="error-container">
    <div class="error-icon">âš ï¸</div>
    <h3>Erreur de chargement</h3>
    <p>{{ errorMessage }}</p>
    <button class="btn-retry" (click)="loadClientData()">RÃ©essayer</button>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="success-banner">
    <span class="success-icon">âœ…</span>
    {{ successMessage }}
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !errorMessage && client" class="profil-content">
    
    <!-- Header avec photo de profil -->
    <div class="profil-header">
      <div class="avatar">
        <span>{{ client.prenom?.charAt(0) }}{{ client.nom?.charAt(0) }}</span>
      </div>
      <div class="user-info">
        <h1>{{ client.prenom }} {{ client.nom }}</h1>
        <p class="user-email">{{ client.courriel }}</p>
        <span class="user-role">{{ getCurrentUserRole() }}</span>
      </div>
    </div>

    <!-- Informations personnelles -->
    <div class="info-section">
      <h2>ğŸ“‹ Informations personnelles</h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Nom complet</label>
          <span>{{ client.nom }} {{ client.prenom }}</span>
        </div>
        <div class="info-item">
          <label>Date de naissance</label>
          <span>{{ formatDate(client.dateNaissance) }}</span>
        </div>
        <div class="info-item">
          <label>Sexe</label>
          <span>{{ getSexeLabel(client.sexe) }}</span>
        </div>
        <div class="info-item">
          <label>NationalitÃ©</label>
          <span>{{ client.nationalite }}</span>
        </div>
        <div class="info-item full-width">
          <label>Adresse</label>
          <span>{{ client.adresse }}</span>
        </div>
        <div class="info-item">
          <label>TÃ©lÃ©phone</label>
          <span>{{ client.telephone }}</span>
        </div>
      </div>
    </div>

    <!-- Mes comptes -->
    <div class="info-section">
      <h2>ğŸ’³ Mes comptes</h2>
      <div *ngIf="comptes.length === 0" class="empty-state">
        <p>Aucun compte trouvÃ©</p>
      </div>
      <div *ngIf="comptes.length > 0" class="comptes-list">
        <div *ngFor="let compte of comptes" class="compte-card">
          <div class="compte-type">
            <span class="type-badge" [class]="compte.typeCompte.toLowerCase()">
              {{ compte.typeCompte === 'COURANT' ? 'ğŸ¦ Courant' : 'ğŸ’° Ã‰pargne' }}
            </span>
          </div>
          <div class="compte-details">
            <div class="compte-numero">{{ compte.numeroCompte }}</div>
            <div class="compte-solde">{{ formatCurrency(compte.solde) }}</div>
            <div class="compte-date">Ouvert le {{ formatDate(compte.dateCreation) }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Transactions rÃ©centes -->
    <div class="info-section">
      <div class="section-header">
        <h2>ğŸ“Š Transactions rÃ©centes</h2>
        <button class="btn-pdf" (click)="openReleveForm()">
          ğŸ“„ TÃ©lÃ©charger PDF
        </button>
      </div>
      
      <div *ngIf="recentTransactions.length === 0" class="empty-state">
        <p>Aucune transaction rÃ©cente</p>
      </div>
      
      <div *ngIf="recentTransactions.length > 0" class="transactions-list">
        <div *ngFor="let transaction of recentTransactions" 
             class="transaction-row" 
             [class]="'transaction-' + transaction.typeTransaction.toLowerCase()">
          <div class="transaction-icon">
            <span *ngIf="transaction.typeTransaction === 'DEPOT'">â¬‡ï¸</span>
            <span *ngIf="transaction.typeTransaction === 'RETRAIT'">â¬†ï¸</span>
            <span *ngIf="transaction.typeTransaction === 'VIREMENT'">â†”ï¸</span>
          </div>
          <div class="transaction-info">
            <div class="transaction-type">{{ getTransactionTypeLabel(transaction.typeTransaction) }}</div>
            <div class="transaction-date">{{ formatDateTime(transaction.dateTransaction) }}</div>
            <div class="transaction-compte">Compte: {{ transaction.compteNumero }}</div>
          </div>
          <div class="transaction-amount" [class]="transaction.typeTransaction === 'DEPOT' ? 'positive' : 'negative'">
            {{ transaction.typeTransaction === 'DEPOT' ? '+' : '-' }}{{ formatCurrency(transaction.montant) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="info-section">
      <h2>âš™ï¸ Actions</h2>
      <div class="actions-grid">
        <button class="action-btn" (click)="editProfile()">
          âœï¸ Modifier mon profil
        </button>
        <button class="action-btn" (click)="changePassword()">
          ğŸ”’ Changer mot de passe
        </button>
        <button class="action-btn" routerLink="/transactions">
          ğŸ’³ Mes transactions
        </button>
        <button class="action-btn" routerLink="/comptes">
          ğŸ¦ Mes comptes
        </button>
        <button class="action-btn danger" (click)="deleteAccount()">
          ğŸ—‘ï¸ Supprimer mon compte
        </button>
        <button class="action-btn danger" (click)="logout()">
          ğŸšª DÃ©connexion
        </button>
      </div>
    </div>
  </div>

  <!-- Modal PDF -->
  <div *ngIf="showReleveForm" class="modal-overlay" (click)="closeReleveForm()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“„ TÃ©lÃ©charger le relevÃ© PDF</h3>
        <button class="modal-close" (click)="closeReleveForm()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Compte</label>
          <select [(ngModel)]="releveForm.numeroCompte" class="form-input">
            <option *ngFor="let compte of comptes" [value]="compte.numeroCompte">
              {{ compte.numeroCompte }} - {{ compte.typeCompte }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Date de dÃ©but</label>
          <input type="date" [(ngModel)]="releveForm.dateDebut" class="form-input" />
        </div>
        <div class="form-group">
          <label>Date de fin</label>
          <input type="date" [(ngModel)]="releveForm.dateFin" class="form-input" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeReleveForm()">Annuler</button>
        <button class="btn-primary" (click)="downloadRelevePDF()">TÃ©lÃ©charger</button>
      </div>
    </div>
  </div>

  <!-- Modal Ã‰dition Profil -->
  <div *ngIf="showEditForm" class="modal-overlay" (click)="closeEditForm()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>âœï¸ Modifier mon profil</h3>
        <button class="modal-close" (click)="closeEditForm()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Nom</label>
          <input type="text" [(ngModel)]="editForm.nom" class="form-input" />
        </div>
        <div class="form-group">
          <label>PrÃ©nom</label>
          <input type="text" [(ngModel)]="editForm.prenom" class="form-input" />
        </div>
        <div class="form-group">
          <label>Date de naissance</label>
          <input type="date" [(ngModel)]="editForm.dateNaissance" class="form-input" />
        </div>
        <div class="form-group">
          <label>Sexe</label>
          <select [(ngModel)]="editForm.sexe" class="form-input">
            <option value="M">Homme</option>
            <option value="F">Femme</option>
          </select>
        </div>
        <div class="form-group">
          <label>Adresse</label>
          <textarea [(ngModel)]="editForm.adresse" class="form-input" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>TÃ©lÃ©phone</label>
          <input type="tel" [(ngModel)]="editForm.telephone" class="form-input" />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="editForm.courriel" class="form-input" />
        </div>
        <div class="form-group">
          <label>NationalitÃ©</label>
          <input type="text" [(ngModel)]="editForm.nationalite" class="form-input" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeEditForm()">Annuler</button>
        <button class="btn-primary" (click)="saveProfile()">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>